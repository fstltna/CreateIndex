#!/usr/bin/perl
use strict;
use warnings;
use File::Next;

my $templatefile = <<'END_TEMPLATE';
<html><body bgcolor="#FFFFFF"></body></html>
END_TEMPLATE
my $file = "";
my $DEBUG_MODE = "off";
my $Confirm = "yes";
my $VERSION = "1.0.0";

print "createindex - index.html file creator v$VERSION\n";
print "===============================================\n";

sub PrintDebugCommand
{
        if ($DEBUG_MODE eq "off")
        {
                return;
        }
        my $PassedString = shift;
        print "$PassedString\n";
	#print "Press Enter To Run This:";
	#my $entered = <STDIN>;
}

sub CreateIndex
{
	my $OutputFile = "$file/index.html";
	if (-f $OutputFile)
	{
		print "$OutputFile already exists - skipping\n";
		return;
	}
	if ($Confirm eq "yes")
	{
		print "About to create $OutputFile - Confirm: Y/n: ";
		my $entered = <STDIN>;
		chop($entered);
		if ($entered eq "n")
		{
			return;
		}
	}
	open(FH, '>', $OutputFile) or die $!;
	print FH "$templatefile";
	close(FH);
}

my ($NoConfirm) = @ARGV;
if (defined $NoConfirm)
{
	if ($NoConfirm eq "noconfirm")
	{
		$Confirm = "no";
	}
	else
        {
		print "Unknown option. Valid options are:\n";
		print "\tnoconfirm\t- Don't confirm each creation\n";
		print "\thelp\t\t- displays this message\n";
		print "\tdebug\t\t- turns on debug mode\n";
		exit 0;
        }

}

if ($Confirm eq "no")
{
	print "No comfirmations\n";
}

my $iter = File::Next::dirs( '.' );
while ( defined ( $file = $iter->() ) )
{
	if (substr($file, 0, 1) eq ".")
	{
		next;
	}
	if (index($file, ".git") != -1)
	{
		PrintDebugCommand("$file contains .git");
		next;
	}
	PrintDebugCommand("saw $file");
	CreateIndex();
}

exit 0;
